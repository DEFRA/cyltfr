{% extends 'layout.html' %}

{% from "components/input/macro.njk" import govukInput %}
{% from "components/error-summary/macro.njk" import govukErrorSummary %}

{% set pageTitle = "Where do you want to check?" %}

{% block content %}
<div id="postcode-page">
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <h1 class="govuk-heading-xl">{{ pageTitle }}</h1>

      {% if errorSummary %}
        {{ govukErrorSummary(errorSummary) }}
      {% endif %}
      {% if friendlyCaptchaEnabled %}
      <div id="session-alert" style="display: none;">
        <div class="govuk-warning-text">
          <span class="govuk-warning-text__icon" aria-hidden="true" style="margin: 0;
          position: absolute;
          top: 40%;
          transform: translateY(-50%);">!</span>
          <strong class="govuk-warning-text__text" style="line-height: 0.6;">
            <span class="govuk-warning-text__assistive">Warning</span>
            Your session will end in a few minutes<p style="margin-bottom: 20px;
            font-weight: normal;
            text-align: justify;">If you do not respond by then, youâ€˜ll need to <a href="/postcode" >start a new search</a></p>
          </strong>
        </div>
      </div>
      <div id="timeout" data-timeout="{{timeout}}">
      </div>
      {% endif %}
      <div class="govuk-inset-text">
        <p>This service will tell you the flood risk of an area, not a specific property.</p>
      </div>

      <form id="postcode-form" method="post">
        {{ govukInput(postcodeInput) }}
        {% if captchaEnabled %}
          <button class="govuk-button g-recaptcha" 
          type="submit"
          data-sitekey={{ captchaSiteKey }}
          data-callback="onSubmit"
          data-action="submit">
          Continue
          </button>
        {% elif friendlyCaptchaEnabled %}
          <div style="margin-bottom: 20px;" class="frc-captcha" data-sitekey={{friendlyCaptchaSiteKey}} data-start="auto"></div>
          <div class="govuk-grid-row">
            <div class="govuk-grid-column-two-thirds">
              <p class="govuk-body" style="color: grey;">
                Friendly Captcha checks that you aren't a robot. Find out how to use it in our <a href="/privacy-notice" 
                class="govuk-link">privacy notice</a>
              </p>
            </div>
          </div>
          <div class="govuk-grid-row">
            <div class="govuk-grid-column-two-thirds">
              <button type="submit" id="post-code-button" class="govuk-button">Continue</button>
            </div>
          </div>
        {% else %}
          <button type="submit" class="govuk-button">Continue</button>
        {% endif %}
      </form>

      <p class="govuk-body">or <a href="/map" class="govuk-link"
          data-journey-click="ltfri:postcode:map">
          view a map showing areas at risk of flooding</a>.
      </p>
      <p class="govuk-body">
        <a href="http://www.royalmail.com/find-a-postcode" class="govuk-link" target="_blank"
          data-journey-click="ltfri:postcode:royal-mail">
          Use the Royal Mail postcode finder
        </a>
      </p>
    </div>
  </div>
</div>
{% if captchaEnabled %}
  <script src="https://www.google.com/recaptcha/api.js?render={{ captchaSiteKey }}"></script>
  <script>
    function onSubmit (token) {
      document.getElementById('postcode-form').submit()
    }
  </script>
{% endif %}
{% if friendlyCaptchaEnabled %}
<noscript>
  <style type="text/css">
    #postcode-page {display:none;}
</style>
<div>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <h1 class="govuk-heading-xl">You need Javascript to use this service</h1>
      <p class="govuk-body">
        Please turn on javascript in your browser to use this service
      </p>
      <p class="govuk-body">
        You can try again by <a href="/postcode">starting a new search</a>
      </p>
      <p class="govuk-body">
        You can call Floodline for advice about flooding to check your long term risk:
      </p>
      <ul class="govuk-list govuk-list--bullet">
        <li>Telephone: 0345 988 1188</li>
        <li>Textphone: 0345 603 6340</li>
      </ul>
      <p class="govuk-body">
        24 hour service.
      </p>
      <p class="govuk-body">
        <a href="https://www.gov.uk/call-charges">Find out about call charges</a>
      </p>
    </div>
  </div>
</div>
 </noscript>
 <script>
  const sessionDiv = document.getElementById('session-alert')
  const sessionTimeout = document.getElementById('timeout').getAttribute('data-timeout')
  const time = (sessionTimeout - 2) * 60 * 1000
  sessionDiv.style.display = 'none'
   const timeout = setTimeout(showSessionAlert,time)
   function showSessionAlert() {
       sessionDiv.style.display = 'block'
   }
  </script>
  <script type="module" src="https://unpkg.com/friendly-challenge@0.9.8/widget.module.min.js" async defer></script>
  <script nomodule src="https://unpkg.com/friendly-challenge@0.9.8/widget.polyfilled.min.js" async defer></script>
{% endif %}
{% endblock %}
